<script>
window.addEventListener('DOMContentLoaded', async(event)=>{
    class Canvas2D {
        constructor(w, h) {
            this.canvas = document.createElement('canvas')
            this.ctx = this.canvas.getContext(`2d`, {alpha:true, colorSpace:'srgb', desynchronized:false, willReadFrequently:true})
            this.d = this.ctx.createImageData(w, h)
            this.draw()
            this.put()
        }
        dot(x, y, r, g, b, a) {
            console.log(x, y, r, g, b, a)
            this.d.data[(x + y * this.d.width) * 4] = r
            this.d.data[(x + y * this.d.width) * 4 + 1] = g
            this.d.data[(x + y * this.d.width) * 4 + 2] = b
            this.d.data[(x + y * this.d.width) * 4 + 3] = a
        }
        draw() {
            for (let i = 0; i < this.d.data.length; i+=4) {
                this.d.data[i + 0] = 190;  // R
                this.d.data[i + 1] = 0;    // G
                this.d.data[i + 2] = 210;  // B
                this.d.data[i + 3] = 255;  // A
            }
        }
        put(dx=0, dy=0) { this.ctx.putImageData(this.d, dx, dy) }
    }
    class IndexedColorImage {
        constructor(w, h) {
            this.cvs = new Canvas2D(w,h)
            this.colors = [[0,0,0,255]]
            this.pixcels = JSON.parse(JSON.stringify((new Array(w)).fill((new Array(h)).fill(0))));
            console.log(this.pixcels)
        }
        dot(x, y, i) { this.cvs.dot(x, y, ...this.colors[i]) }
        make() {
            console.log(this.cvs.d.width)
            for (let x=0; x<this.cvs.d.width; x++) {
                for (let y=0; y<this.cvs.d.height; y++) {
                    console.log(this.pixcels[x][y], this.colors[this.pixcels[x][y]], ...this.colors[this.pixcels[x][y]])
                    this.dot(x, y, this.pixcels[x][y])
                }
            }
            this.cvs.put();
        }
    }
    const ici = new IndexedColorImage(16,16)
    ici.make()
    console.log(ici)
    document.body.appendChild(ici.cvs.canvas)
})
</script>
